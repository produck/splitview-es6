/*!
 * Splitview v0.1.1
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
const e=4*window.screen.width;const n={display:"block",top:"0",left:"0",position:"relative",width:"100%",height:"100%",overflow:"hidden",border:"none",padding:"0",margin:"0"},t={display:"block",position:"absolute",overflow:"hidden"},i={display:"block",overflow:"visible",top:"0",left:"0",position:"absolute","z-index":"1"},r={display:"block",position:"absolute","transition-property":"background-color","transition-duration":"0.2s","transition-delay":"0.1s","user-select":"none"},o=window,s=document;function a(){return s.createElement("div")}function c(e,n){e.className=n}function u(e,n,t){e.addEventListener(n,t)}function l(e,n,t){e.removeEventListener(n,t)}function p(e,n){const t=new Event(e,{bubbles:!0});return t.data=n,t}function h(e,n){for(const t in n)e.style.setProperty(t,n[t],"important")}const d={row:{p:"clientX",cSS:"height",cSO:"top",sS:"width",sO:"left",oS:"offsetWidth",o:"offsetLeft",sCV:"col-resize"},column:{p:"clientY",cSS:"width",cSO:"left",sS:"height",sO:"top",oS:"offsetHeight",o:"offsetTop",sCV:"row-resize"}},f=e=>e._size,m=e=>e.min;function v(e,n,t){let i=0;return e.each(n,(e=>i+=t(e))),i}function x(e){return{pulled:e.prev,limit:{pull:e.prev.max,push:v(e.prev,"next",m)},origin:{pull:e.prev.size,push:v(e.prev,"next",f)}}}function w(e){return{pulled:e,limit:{pull:e.max,push:v(e,"prev",m)},origin:{pull:e.size,push:v(e,"prev",f)}}}function g(e){const n=z({max:0,min:0},e),t=new Object(n);return t.view=null,t}function z(e,n){const i=a(),d=a();function f(e,n,t){const{limit:i,origin:r,pulled:o}=t;o.size=Math.min(i.pull,r.pull+r.push-i.push,r.pull+e);let s=o.size-r.pull;o.each(n,(e=>{const n=e._size-s>e.min?s:e._size-e.min;e.size=e._size-n,s-=n}))}function m(e){const t=v.resizing&&n.resizing,r=e&&!n.resizing;h(i,t||r?{"background-color":"#007fd4",cursor:n.axis.sCV}:{"background-color":null,cursor:"default"})}c(d,"sv-view"),c(i,"sv-handler"),h(d,t),function(e){h(e,r)}(i),u(i,"mousedown",(function(e){const t=e[n.axis.p];h(s.body,{cursor:n.axis.sCV}),v.resizing=n.resizing=!0,n.snapshot();const i={next:x(v),prev:w(v)};function r(e){const r=e[n.axis.p]-t;if(n.restore(),0!==r){const e=r>0?"next":"prev";f(Math.abs(r),e,i[e])}}u(o,"mousemove",r),u(o,"mouseup",(function e(){l(o,"mousemove",r),l(o,"mouseup",e),h(s.body,{cursor:"default"}),v.resizing=n.resizing=!1,m()}))})),u(i,"mouseover",(()=>m(!0))),u(i,"mouseout",(()=>m(!1))),u(i,"dblclick",(function(){const e=p("request-reset",v.view);i.dispatchEvent(e)}));const v={resizing:!1,_size:0,prev:null,next:null,get min(){return e.min},get max(){return e.max},get resizable(){return e.max!==e.min},get eView(){return d},get eHandler(){return i},get size(){return d[n.axis.oS]||.1},get o(){return d[n.axis.o]},set size(e){if(v.size===e)return;const t=p("view-size-change",v.view);h(d,{[n.axis.sS]:`${e}px`}),v.each("next",(e=>e.fixOffset())),d.dispatchEvent(t)},each(e,n){let t=v[e];for(;null!==t&&null!==t[e];)n(t),t=t[e]},fixOffset(){const e=v.prev.o+v.prev.size;h(d,{[n.axis.sO]:`${e}px`}),h(i,{[n.axis.sO]:e-2+"px "})},relayout(){h(d,{[n.axis.cSS]:"100%",[n.axis.cSO]:"0"}),h(i,{[n.axis.cSS]:"100%",[n.axis.cSO]:"0",[n.axis.sS]:"4px",display:v.prev.resizable?"block":"none"}),v.size=v.min},view:Object.seal({get container(){return n.container},get element(){return d},get previousSibling(){return v.prev.view},get nextSibling(){return v.next.view},get size(){return v.size},setSize(e){if("number"!=typeof e)throw new TypeError("A view size MUST be a number.");const t=Math.max(Math.min(e,v.max),v.min),i=t-v.size;if(0===i)return;n.snapshot();const r=i>0?"next":"prev";return f(Math.abs(i),r,{next:x,prev:w}[r](v.next)),Math.abs(t-v.size)}})};return v}function b(){const t=a(),r=a();c(t,"sv-container"),c(r,"sv-handler-container"),h(t,n),function(e){h(e,i)}(r),t.appendChild(r);let s=null;function u(){clearTimeout(s);const e=[];b.head.each("next",(n=>e.push(n))),e.sort(((e,n)=>e.max-e.min-(n.max-n.min)));const n=e.reduce(((n,t,i)=>{const r=e.slice(i).reduce(((e,n)=>e+n.size),0),o=Math.round(t.size/r*n),s=Math.max(Math.min(t.max,o),t.min);return t.size=s,n-s}),t[b.axis.oS]);b.head.each("next",(e=>e.fixOffset())),0!==n&&(s=setTimeout((()=>console.warn(`Splitview: free ${n}px`)),1e3))}let l=null;function f(){null!==t.parentElement&&(h(r,{[b.axis.cSS]:"100%",[b.axis.sS]:"0"}),b.head.each("next",(e=>e.relayout())),u())}function m(e){b.rear.prev.next=e,e.prev=b.rear.prev,e.next=b.rear,b.rear.prev=e,t.appendChild(e.eView),r.appendChild(e.eHandler)}function v(e){e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,t.removeChild(e.eView),r.removeChild(e.eHandler)}function x(e){if(e.container!==b.container)throw new Error("The view does NOT belongs to this container.")}const w=new WeakMap,b={resizing:!1,axis:d.row,direction:"row",head:null,rear:null,snapshot(){b.head.each("next",(e=>e._size=e.size))},restore(){b.head.each("next",(e=>e.size=e._size))},container:Object.seal({set direction(e){if("row"!==e&&"column"!==e)throw new Error("A direction MUST be `row` or `column`.");e!==b.direction&&(b.direction=e,b.axis=d[e],f())},get direction(){return b.direction},get element(){return t},get firstView(){return b.head.next.view},get lastView(){return b.rear.prev.view},get viewList(){const e=[];return b.head.each("next",(n=>e.push(n.view))),e},mount(e){e.appendChild(t),f(),function(){const e={width:t.offsetWidth,height:t.offsetHeight};!function n(){const i=t.offsetWidth,r=t.offsetHeight;if(e.width!==i||e.height!==r){const e=p("container-size-change",b.container);u(),t.dispatchEvent(e)}e.width=i,e.height=r,l=o.requestAnimationFrame(n)}()}()},destroy(){t.parentElement.removeChild(t),cancelAnimationFrame(l)},relayout:f,appendView:e=>(x(e),m(w.get(e)),f(),e),removeView(e){x(e);const n=w.get(e);if(void 0===n)throw new Error("The view is NOT in container.");return v(n),f(),e},insertBefore(e,n=null){if(x(e),null===n)m(w.get(n));else{if(n.container!==b.container)throw new Error("The reference view does NOT belongs to this container.");null!==e.previousSibling&&v(w.get(e));const i=w.get(e),o=w.get(n);i.next=o,i.prev=o.prev,o.prev.next=i,o.prev=i,t.insertBefore(i.eView,o.eView),r.insertBefore(i.eHandler,o.eHandler)}return f(),e},createView(n={}){if("object"!=typeof n)throw new Error("An options MUST be an object.");const t=z(function(n){const t={min:50,max:e},{min:i=t.min,max:r=t.max}=n;if(i<0||!isFinite(i))throw new Error("A min MUST be >= 0 and finity.");if(r<i)throw new Error("A max MUST >= the min and finity.");return t.min=i,t.max=r,t}(n),b);return w.set(t.view,t),t.view}})};return b.head=g(b),b.rear=g(b),b.head.next=b.rear,b.rear.prev=b.head,b.container}export{b as Container};
