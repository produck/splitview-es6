/*!
 * @produck/splitview v0.1.3
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
const e=4*window.screen.width;const n={display:"block",top:"0",left:"0",position:"relative",width:"100%",height:"100%",overflow:"hidden",border:"none",padding:"0",margin:"0"},t={display:"block",position:"absolute",overflow:"hidden"},i={display:"block",overflow:"visible",top:"0",left:"0",position:"absolute","z-index":"1"},o={display:"block",position:"absolute","transition-property":"background-color","transition-duration":"0.2s","transition-delay":"0.1s","user-select":"none"},r=window,s=document,c=Math;function u(){return s.createElement("div")}function l(e,n){e.className=n}function a(e,n,t){e.addEventListener(n,t)}function d(e,n,t){e.removeEventListener(n,t)}function f(e,n){const t=new Event(e,{bubbles:!0});return t.data=n,t}function m(e,n,t){return c.max(c.min(t,n),e)}function p(e,n){for(const t in n)e.style.setProperty(t,n[t],"important")}const h={row:{p:"clientX",cSS:"height",cSO:"top",sS:"width",sO:"left",oS:"offsetWidth",o:"offsetLeft",sCV:"col-resize"},column:{p:"clientY",cSS:"width",cSO:"left",sS:"height",sO:"top",oS:"offsetHeight",o:"offsetTop",sCV:"row-resize"}},w=e=>e._size,v=e=>e.min;function g(e,n,t){let i=0;return e.each(n,(e=>i+=t(e))),i}const b={1:function(e){const n=e[0];return{direction:1,pulled:n,limit:{pull:n.max,push:g(n,1,v)},origin:{pull:n.size,push:g(n,1,w)}}},0:function(e){const n=e;return{direction:0,pulled:n,limit:{pull:n.max,push:g(n,0,v)},origin:{pull:n.size,push:g(n,0,w)}}}};function z(e,n){return c.trunc(c.abs(e-n))}function x(e){const n=S({max:0,min:0},e),t=new Object(n);return t.view=null,t}function S(e,n){const i=u(),h=u();function w(e,n){const{limit:t,origin:i,pulled:o,direction:r}=n;o.size=c.min(t.pull,i.pull+i.push-t.push,i.pull+e);let s=o.size-i.pull;o.each(r,(e=>{const n=e._size-s>e.min?s:e._size-e.min;e.size=e._size-n,s-=n}))}l(h,"sv-view"),l(i,"sv-handler"),p(h,t),function(e){p(e,o)}(i);let v=!1;function g(){const e=x[9]&&n[9],t=v&&!n[9],o=e||t;p(i,{"background-color":o?"#007fd4":null}),p(s.body,{cursor:o?n.axis.sCV:"default"})}a(i,"mouseover",(()=>v=!0)),a(i,"mouseout",(()=>v=!1)),a(i,"mousedown",(function(e){const{axis:t}=n,i=e[t.p];p(s.body,{cursor:t.sCV}),x[9]=n[9]=!0,n.snapshot();const o={1:b[1](x),0:b[0](x)};function u(e){const r=e[t.p]-i;n.restore(),0!==r&&w(c.abs(r),o[r>0?1:0])}a(r,"mousemove",u),a(r,"mouseup",(function e(){d(r,"mousemove",u),d(r,"mouseup",e),x[9]=n[9]=!1,g()}))})),a(i,"mouseover",g),a(i,"mouseout",g),a(i,"dblclick",(function(){i.dispatchEvent(f("request-reset",x.view))}));const x={9:!1,_size:0,0:null,1:null,get min(){return e.min},get max(){return e.max},get resizable(){return e.max!==e.min},get eView(){return h},get eHandler(){return i},get size(){return h[n.axis.oS]+.01},get o(){return h[n.axis.o]},set size(e){e=c.trunc(e),x.size!==e&&(p(h,{[n.axis.sS]:`${e}px`}),x.each(1,(e=>e[8]())),h.dispatchEvent(f("view-size-change",x.view)))},each(e,n){let t=x[e];for(;null!==t&&null!==t[e];)n(t),t=t[e]},8(){const{axis:e}=n,t=c.trunc(x[0].o+x[0].size);p(h,{[e.sO]:`${t}px`}),p(i,{[e.sO]:t-2+"px "})},relayout(){const{axis:e}=n;p(h,{[e.cSS]:"100%",[e.cSO]:"0"}),p(i,{[e.cSS]:"100%",[e.cSO]:"0",[e.sS]:"4px",display:x[0].resizable?"block":"none"}),x.size=x.min},view:Object.seal({get container(){return n[7]},get element(){return h},get previousSibling(){return x[0].view},get nextSibling(){return x[1].view},get size(){return c.trunc(x.size)},setSize(e){if("number"!=typeof e)throw new Error("A view size MUST be a number.");const t=m(x.min,x.max,e);if(!n[9]){if(0===z(t,x.size))return 0;n.snapshot();const e=t-x.size;if(w(c.abs(e),b[e>0?1:0](x[1])),0!==z(t,x.size)){const e=t-x.size;w(c.abs(e),b[e>0?0:1](x))}}return z(t,x.size)}})};return x}function y(){const t=u(),o=u();l(t,"sv-container"),l(o,"sv-handler-container"),p(t,n),function(e){p(e,i)}(o),t.appendChild(o);let s=null;function a(){clearTimeout(s);const e=[];y[0].each(1,(n=>e.push(n))),e.sort(((e,n)=>e.max-e.min-(n.max-n.min)));const n=e.reduce(((n,t,i)=>{const o=e.slice(i).reduce(((e,n)=>e+n.size),0),r=c.round(t.size/o*n),s=m(t.min,t.max,r);return t.size=s,n-s}),t[y.axis.oS]);y[0].each(1,(e=>e[8]())),0!==n&&(s=setTimeout((()=>console.warn(`Splitview: free ${n}px`)),1e3))}let d=null;function w(){null!==t.parentElement&&(p(o,{[y.axis.cSS]:"100%",[y.axis.sS]:"0"}),y[0].each(1,(e=>e.relayout())),a())}function v(e){y[1][0][1]=e,e[0]=y[1][0],e[1]=y[1],y[1][0]=e,t.appendChild(e.eView),o.appendChild(e.eHandler)}function g(e){e[0][1]=e[1],e[1][0]=e[0],e[1]=e[0]=null,t.removeChild(e.eView),o.removeChild(e.eHandler)}function b(e){if(e.container!==y[7])throw new Error("The view does NOT belongs to this container.")}const z=new WeakMap,y={9:!1,axis:h.row,direction:"row",0:null,1:null,snapshot(){y[0].each(1,(e=>e._size=e.size))},restore(){y[0].each(1,(e=>e.size=e._size))},7:Object.seal({get resizing(){return y[9]},set direction(e){if("row"!==e&&"column"!==e)throw new Error("A direction MUST be `row` or `column`.");e!==y.direction&&(y.direction=e,y.axis=h[e],w())},get direction(){return y.direction},get element(){return t},get firstView(){return y[0][1].view},get lastView(){return y[1][0].view},get viewList(){const e=[];return y[0].each(1,(n=>e.push(n.view))),e},mount(e){e.appendChild(t),w(),function(){let e=t.offsetWidth,n=t.offsetHeight;!function i(){const o=t.offsetWidth,s=t.offsetHeight;e===o&&n===s||(a(),t.dispatchEvent(f("container-size-change",y[7]))),e=o,n=s,d=r.requestAnimationFrame(i)}()}()},destroy(){t.parentElement.removeChild(t),cancelAnimationFrame(d)},relayout:w,appendView:e=>(b(e),v(z.get(e)),w(),e),removeView(e){b(e);const n=z.get(e);if(void 0===n)throw new Error("The view is NOT in container.");return g(n),w(),e},insertBefore(e,n=null){if(b(e),null===n)v(z.get(n));else{if(n.container!==y[7])throw new Error("The reference view does NOT belongs to this container.");null!==e.previousSibling&&g(z.get(e));const i=z.get(e),r=z.get(n);i[1]=r,i[0]=r[0],r[0][1]=i,r[0]=i,t.insertBefore(i.eView,r.eView),o.insertBefore(i.eHandler,r.eHandler)}return w(),e},createView(n={}){if("object"!=typeof n)throw new Error("An options MUST be an object.");const t=S(function(n){const t={min:50,max:e},{min:i=t.min,max:o=t.max}=n;if(i<0||!isFinite(i))throw new Error("A min MUST be >= 0 and finity.");if(o<i)throw new Error("A max MUST >= the min and finity.");return t.min=i,t.max=o,t}(n),y);return z.set(t.view,t),t.view}})};return y[0]=x(y),y[1]=x(y),y[0][1]=y[1],y[1][0]=y[0],y[7]}export{y as Container};
