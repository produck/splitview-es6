/*!
 * Splitview v0.1.1
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).splitview={})}(this,(function(e){"use strict";const n=4*window.screen.width;const t={display:"block",top:"0",left:"0",position:"relative",width:"100%",height:"100%",overflow:"hidden",border:"none",padding:"0",margin:"0"},i={display:"block",position:"absolute",overflow:"hidden"},r={display:"block",overflow:"visible",top:"0",left:"0",position:"absolute","z-index":"1"},o={display:"block",position:"absolute","transition-property":"background-color","transition-duration":"0.2s","transition-delay":"0.1s","user-select":"none"},s=window,a=document;function c(){return a.createElement("div")}function u(e,n){e.className=n}function l(e,n,t){e.addEventListener(n,t)}function p(e,n,t){e.removeEventListener(n,t)}function d(e,n){const t=new Event(e,{bubbles:!0});return t.data=n,t}function f(e,n){for(const t in n)e.style.setProperty(t,n[t],"important")}const h={row:{p:"clientX",cSS:"height",cSO:"top",sS:"width",sO:"left",oS:"offsetWidth",o:"offsetLeft",sCV:"col-resize"},column:{p:"clientY",cSS:"width",cSO:"left",sS:"height",sO:"top",oS:"offsetHeight",o:"offsetTop",sCV:"row-resize"}},m=e=>e._size,v=e=>e.min;function x(e,n,t){let i=0;return e.each(n,(e=>i+=t(e))),i}function w(e){return{pulled:e.prev,limit:{pull:e.prev.max,push:x(e.prev,"next",v)},origin:{pull:e.prev.size,push:x(e.prev,"next",m)}}}function g(e){return{pulled:e,limit:{pull:e.max,push:x(e,"prev",v)},origin:{pull:e.size,push:x(e,"prev",m)}}}function b(e){const n=z({max:0,min:0},e),t=new Object(n);return t.view=null,t}function z(e,n){const t=c(),r=c();function h(e,n,t){const{limit:i,origin:r,pulled:o}=t;o.size=Math.min(i.pull,r.pull+r.push-i.push,r.pull+e);let s=o.size-r.pull;o.each(n,(e=>{const n=e._size-s>e.min?s:e._size-e.min;e.size=e._size-n,s-=n}))}function m(e){const i=v.resizing&&n.resizing,r=e&&!n.resizing;f(t,i||r?{"background-color":"#007fd4",cursor:n.axis.sCV}:{"background-color":null,cursor:"default"})}u(r,"sv-view"),u(t,"sv-handler"),f(r,i),function(e){f(e,o)}(t),l(t,"mousedown",(function(e){const t=e[n.axis.p];f(a.body,{cursor:n.axis.sCV}),v.resizing=n.resizing=!0,n.snapshot();const i={next:w(v),prev:g(v)};function r(e){const r=e[n.axis.p]-t;if(n.restore(),0!==r){const e=r>0?"next":"prev";h(Math.abs(r),e,i[e])}}l(s,"mousemove",r),l(s,"mouseup",(function e(){p(s,"mousemove",r),p(s,"mouseup",e),f(a.body,{cursor:"default"}),v.resizing=n.resizing=!1,m()}))})),l(t,"mouseover",(()=>m(!0))),l(t,"mouseout",(()=>m(!1))),l(t,"dblclick",(function(){const e=d("request-reset",v.view);t.dispatchEvent(e)}));const v={resizing:!1,_size:0,prev:null,next:null,get min(){return e.min},get max(){return e.max},get resizable(){return e.max!==e.min},get eView(){return r},get eHandler(){return t},get size(){return r[n.axis.oS]||.1},get o(){return r[n.axis.o]},set size(e){if(v.size===e)return;const t=d("view-size-change",v.view);f(r,{[n.axis.sS]:`${e}px`}),v.each("next",(e=>e.fixOffset())),r.dispatchEvent(t)},each(e,n){let t=v[e];for(;null!==t&&null!==t[e];)n(t),t=t[e]},fixOffset(){const e=v.prev.o+v.prev.size;f(r,{[n.axis.sO]:`${e}px`}),f(t,{[n.axis.sO]:e-2+"px "})},relayout(){f(r,{[n.axis.cSS]:"100%",[n.axis.cSO]:"0"}),f(t,{[n.axis.cSS]:"100%",[n.axis.cSO]:"0",[n.axis.sS]:"4px",display:v.prev.resizable?"block":"none"}),v.size=v.min},view:Object.seal({get container(){return n.container},get element(){return r},get previousSibling(){return v.prev.view},get nextSibling(){return v.next.view},get size(){return v.size},setSize(e){if("number"!=typeof e)throw new TypeError("A view size MUST be a number.");const t=Math.max(Math.min(e,v.max),v.min),i=t-v.size;if(0===i)return;n.snapshot();const r=i>0?"next":"prev";return h(Math.abs(i),r,{next:w,prev:g}[r](v.next)),Math.abs(t-v.size)}})};return v}e.Container=function(){const e=c(),i=c();u(e,"sv-container"),u(i,"sv-handler-container"),f(e,t),function(e){f(e,r)}(i),e.appendChild(i);let o=null;function a(){clearTimeout(o);const n=[];g.head.each("next",(e=>n.push(e))),n.sort(((e,n)=>e.max-e.min-(n.max-n.min)));const t=n.reduce(((e,t,i)=>{const r=n.slice(i).reduce(((e,n)=>e+n.size),0),o=Math.round(t.size/r*e),s=Math.max(Math.min(t.max,o),t.min);return t.size=s,e-s}),e[g.axis.oS]);g.head.each("next",(e=>e.fixOffset())),0!==t&&(o=setTimeout((()=>console.warn(`Splitview: free ${t}px`)),1e3))}let l=null;function p(){null!==e.parentElement&&(f(i,{[g.axis.cSS]:"100%",[g.axis.sS]:"0"}),g.head.each("next",(e=>e.relayout())),a())}function m(n){g.rear.prev.next=n,n.prev=g.rear.prev,n.next=g.rear,g.rear.prev=n,e.appendChild(n.eView),i.appendChild(n.eHandler)}function v(n){n.prev.next=n.next,n.next.prev=n.prev,n.next=n.prev=null,e.removeChild(n.eView),i.removeChild(n.eHandler)}function x(e){if(e.container!==g.container)throw new Error("The view does NOT belongs to this container.")}const w=new WeakMap,g={resizing:!1,axis:h.row,direction:"row",head:null,rear:null,snapshot(){g.head.each("next",(e=>e._size=e.size))},restore(){g.head.each("next",(e=>e.size=e._size))},container:Object.seal({set direction(e){if("row"!==e&&"column"!==e)throw new Error("A direction MUST be `row` or `column`.");e!==g.direction&&(g.direction=e,g.axis=h[e],p())},get direction(){return g.direction},get element(){return e},get firstView(){return g.head.next.view},get lastView(){return g.rear.prev.view},get viewList(){const e=[];return g.head.each("next",(n=>e.push(n.view))),e},mount(n){n.appendChild(e),p(),function(){const n={width:e.offsetWidth,height:e.offsetHeight};!function t(){const i=e.offsetWidth,r=e.offsetHeight;if(n.width!==i||n.height!==r){const n=d("container-size-change",g.container);a(),e.dispatchEvent(n)}n.width=i,n.height=r,l=s.requestAnimationFrame(t)}()}()},destroy(){e.parentElement.removeChild(e),cancelAnimationFrame(l)},relayout:p,appendView:e=>(x(e),m(w.get(e)),p(),e),removeView(e){x(e);const n=w.get(e);if(void 0===n)throw new Error("The view is NOT in container.");return v(n),p(),e},insertBefore(n,t=null){if(x(n),null===t)m(w.get(t));else{if(t.container!==g.container)throw new Error("The reference view does NOT belongs to this container.");null!==n.previousSibling&&v(w.get(n));const r=w.get(n),o=w.get(t);r.next=o,r.prev=o.prev,o.prev.next=r,o.prev=r,e.insertBefore(r.eView,o.eView),i.insertBefore(r.eHandler,o.eHandler)}return p(),n},createView(e={}){if("object"!=typeof e)throw new Error("An options MUST be an object.");const t=z(function(e){const t={min:50,max:n},{min:i=t.min,max:r=t.max}=e;if(i<0||!isFinite(i))throw new Error("A min MUST be >= 0 and finity.");if(r<i)throw new Error("A max MUST >= the min and finity.");return t.min=i,t.max=r,t}(e),g);return w.set(t.view,t),t.view}})};return g.head=b(g),g.rear=b(g),g.head.next=g.rear,g.rear.prev=g.head,g.container},Object.defineProperty(e,"__esModule",{value:!0})}));
