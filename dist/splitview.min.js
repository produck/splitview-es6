/*!
 * @produck/splitview v0.1.3
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).splitview={})}(this,(function(e){"use strict";const n=4*window.screen.width;const t={display:"block",top:"0",left:"0",position:"relative",width:"100%",height:"100%",overflow:"hidden",border:"none",padding:"0",margin:"0"},i={display:"block",position:"absolute",overflow:"hidden"},o={display:"block",overflow:"visible",top:"0",left:"0",position:"absolute","z-index":"1"},r={display:"block",position:"absolute","transition-property":"background-color","transition-duration":"0.2s","transition-delay":"0.1s","user-select":"none"},s=window,u=document,c=Math;function l(){return u.createElement("div")}function a(e,n){e.className=n}function f(e,n,t){e.addEventListener(n,t)}function d(e,n,t){e.removeEventListener(n,t)}function p(e,n){const t=new Event(e,{bubbles:!0});return t.data=n,t}function m(e,n,t){return c.max(c.min(t,n),e)}function h(e,n){for(const t in n)e.style.setProperty(t,n[t],"important")}const w={row:{p:"clientX",cSS:"height",cSO:"top",sS:"width",sO:"left",oS:"offsetWidth",o:"offsetLeft",sCV:"col-resize"},column:{p:"clientY",cSS:"width",cSO:"left",sS:"height",sO:"top",oS:"offsetHeight",o:"offsetTop",sCV:"row-resize"}},v=e=>e._size,g=e=>e.min;function b(e,n,t){let i=0;return e.each(n,(e=>i+=t(e))),i}const z={1:function(e){const n=e[0];return{direction:1,pulled:n,limit:{pull:n.max,push:b(n,1,g)},origin:{pull:n.size,push:b(n,1,v)}}},0:function(e){const n=e;return{direction:0,pulled:n,limit:{pull:n.max,push:b(n,0,g)},origin:{pull:n.size,push:b(n,0,v)}}}};function x(e,n){return c.trunc(c.abs(e-n))}function S(e){const n=y({max:0,min:0},e),t=new Object(n);return t.view=null,t}function y(e,n){const t=l(),o=l();function w(e,n){const{limit:t,origin:i,pulled:o,direction:r}=n;o.size=c.min(t.pull,i.pull+i.push-t.push,i.pull+e);let s=o.size-i.pull;o.each(r,(e=>{const n=e._size-s>e.min?s:e._size-e.min;e.size=e._size-n,s-=n}))}a(o,"sv-view"),a(t,"sv-handler"),h(o,i),function(e){h(e,r)}(t);let v=!1;function g(){const e=b[9]&&n[9],i=v&&!n[9],o=e||i;h(t,{"background-color":o?"#007fd4":null}),h(u.body,{cursor:o?n.axis.sCV:"default"})}f(t,"mouseover",(()=>v=!0)),f(t,"mouseout",(()=>v=!1)),f(t,"mousedown",(function(e){const{axis:t}=n,i=e[t.p];h(u.body,{cursor:t.sCV}),b[9]=n[9]=!0,n.snapshot();const o={1:z[1](b),0:z[0](b)};function r(e){const r=e[t.p]-i;n.restore(),0!==r&&w(c.abs(r),o[r>0?1:0])}f(s,"mousemove",r),f(s,"mouseup",(function e(){d(s,"mousemove",r),d(s,"mouseup",e),b[9]=n[9]=!1,g()}))})),f(t,"mouseover",g),f(t,"mouseout",g),f(t,"dblclick",(function(){t.dispatchEvent(p("request-reset",b.view))}));const b={9:!1,_size:0,0:null,1:null,get min(){return e.min},get max(){return e.max},get resizable(){return e.max!==e.min},get eView(){return o},get eHandler(){return t},get size(){return o[n.axis.oS]+.01},get o(){return o[n.axis.o]},set size(e){e=c.trunc(e),b.size!==e&&(h(o,{[n.axis.sS]:`${e}px`}),b.each(1,(e=>e[8]())),o.dispatchEvent(p("view-size-change",b.view)))},each(e,n){let t=b[e];for(;null!==t&&null!==t[e];)n(t),t=t[e]},8(){const{axis:e}=n,i=c.trunc(b[0].o+b[0].size);h(o,{[e.sO]:`${i}px`}),h(t,{[e.sO]:i-2+"px "})},relayout(){const{axis:e}=n;h(o,{[e.cSS]:"100%",[e.cSO]:"0"}),h(t,{[e.cSS]:"100%",[e.cSO]:"0",[e.sS]:"4px",display:b[0].resizable?"block":"none"}),b.size=b.min},view:Object.seal({get container(){return n[7]},get element(){return o},get previousSibling(){return b[0].view},get nextSibling(){return b[1].view},get size(){return c.trunc(b.size)},setSize(e){if("number"!=typeof e)throw new Error("A view size MUST be a number.");const t=m(b.min,b.max,e);if(!n[9]){if(0===x(t,b.size))return 0;n.snapshot();const e=t-b.size;if(w(c.abs(e),z[e>0?1:0](b[1])),0!==x(t,b.size)){const e=t-b.size;w(c.abs(e),z[e>0?0:1](b))}}return x(t,b.size)}})};return b}e.Container=function(){const e=l(),i=l();a(e,"sv-container"),a(i,"sv-handler-container"),h(e,t),function(e){h(e,o)}(i),e.appendChild(i);let r=null;function u(){clearTimeout(r);const n=[];x[0].each(1,(e=>n.push(e))),n.sort(((e,n)=>e.max-e.min-(n.max-n.min)));const t=n.reduce(((e,t,i)=>{const o=n.slice(i).reduce(((e,n)=>e+n.size),0),r=c.round(t.size/o*e),s=m(t.min,t.max,r);return t.size=s,e-s}),e[x.axis.oS]);x[0].each(1,(e=>e[8]())),0!==t&&(r=setTimeout((()=>console.warn(`Splitview: free ${t}px`)),1e3))}let f=null;function d(){null!==e.parentElement&&(h(i,{[x.axis.cSS]:"100%",[x.axis.sS]:"0"}),x[0].each(1,(e=>e.relayout())),u())}function v(n){x[1][0][1]=n,n[0]=x[1][0],n[1]=x[1],x[1][0]=n,e.appendChild(n.eView),i.appendChild(n.eHandler)}function g(n){n[0][1]=n[1],n[1][0]=n[0],n[1]=n[0]=null,e.removeChild(n.eView),i.removeChild(n.eHandler)}function b(e){if(e.container!==x[7])throw new Error("The view does NOT belongs to this container.")}const z=new WeakMap,x={9:!1,axis:w.row,direction:"row",0:null,1:null,snapshot(){x[0].each(1,(e=>e._size=e.size))},restore(){x[0].each(1,(e=>e.size=e._size))},7:Object.seal({get resizing(){return x[9]},set direction(e){if("row"!==e&&"column"!==e)throw new Error("A direction MUST be `row` or `column`.");e!==x.direction&&(x.direction=e,x.axis=w[e],d())},get direction(){return x.direction},get element(){return e},get firstView(){return x[0][1].view},get lastView(){return x[1][0].view},get viewList(){const e=[];return x[0].each(1,(n=>e.push(n.view))),e},mount(n){n.appendChild(e),d(),function(){let n=e.offsetWidth,t=e.offsetHeight;!function i(){const o=e.offsetWidth,r=e.offsetHeight;n===o&&t===r||(u(),e.dispatchEvent(p("container-size-change",x[7]))),n=o,t=r,f=s.requestAnimationFrame(i)}()}()},destroy(){e.parentElement.removeChild(e),cancelAnimationFrame(f)},relayout:d,appendView:e=>(b(e),v(z.get(e)),d(),e),removeView(e){b(e);const n=z.get(e);if(void 0===n)throw new Error("The view is NOT in container.");return g(n),d(),e},insertBefore(n,t=null){if(b(n),null===t)v(z.get(t));else{if(t.container!==x[7])throw new Error("The reference view does NOT belongs to this container.");null!==n.previousSibling&&g(z.get(n));const o=z.get(n),r=z.get(t);o[1]=r,o[0]=r[0],r[0][1]=o,r[0]=o,e.insertBefore(o.eView,r.eView),i.insertBefore(o.eHandler,r.eHandler)}return d(),n},createView(e={}){if("object"!=typeof e)throw new Error("An options MUST be an object.");const t=y(function(e){const t={min:50,max:n},{min:i=t.min,max:o=t.max}=e;if(i<0||!isFinite(i))throw new Error("A min MUST be >= 0 and finity.");if(o<i)throw new Error("A max MUST >= the min and finity.");return t.min=i,t.max=o,t}(e),x);return z.set(t.view,t),t.view}})};return x[0]=S(x),x[1]=S(x),x[0][1]=x[1],x[1][0]=x[0],x[7]},Object.defineProperty(e,"__esModule",{value:!0})}));
