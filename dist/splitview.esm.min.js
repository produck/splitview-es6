/*!
 * Splitview v0.1.2
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
const e=4*window.screen.width;const n={display:"block",top:"0",left:"0",position:"relative",width:"100%",height:"100%",overflow:"hidden",border:"none",padding:"0",margin:"0"},i={display:"block",position:"absolute",overflow:"hidden"},t={display:"block",overflow:"visible",top:"0",left:"0",position:"absolute","z-index":"1"},o={display:"block",position:"absolute","transition-property":"background-color","transition-duration":"0.2s","transition-delay":"0.1s","user-select":"none"},r=window,s=document,c=Math;function u(){return s.createElement("div")}function l(e,n){e.className=n}function a(e,n,i){e.addEventListener(n,i)}function f(e,n,i){e.removeEventListener(n,i)}function d(e,n){const i=new Event(e,{bubbles:!0});return i.data=n,i}function h(e,n,i){return c.max(c.min(i,n),e)}function m(e,n){for(const i in n)e.style.setProperty(i,n[i],"important")}const p={row:{p:"clientX",cSS:"height",cSO:"top",sS:"width",sO:"left",oS:"offsetWidth",o:"offsetLeft",sCV:"col-resize"},column:{p:"clientY",cSS:"width",cSO:"left",sS:"height",sO:"top",oS:"offsetHeight",o:"offsetTop",sCV:"row-resize"}},w=e=>e._size,g=e=>e.min;function v(e,n,i){let t=0;return e.each(n,(e=>t+=i(e))),t}const z={1:function(e){const n=e[0];return{direction:1,pulled:n,limit:{pull:n.max,push:v(n,1,g)},origin:{pull:n.size,push:v(n,1,w)}}},0:function(e){const n=e;return{direction:0,pulled:n,limit:{pull:n.max,push:v(n,0,g)},origin:{pull:n.size,push:v(n,0,w)}}}};function b(e,n){return c.trunc(c.abs(e-n))}function x(e){const n=S({max:0,min:0},e),i=new Object(n);return i.view=null,i}function S(e,n){const t=u(),p=u();function w(e,n){const{limit:i,origin:t,pulled:o,direction:r}=n;o.size=c.min(i.pull,t.pull+t.push-i.push,t.pull+e);let s=o.size-t.pull;o.each(r,(e=>{const n=e._size-s>e.min?s:e._size-e.min;e.size=e._size-n,s-=n}))}l(p,"sv-view"),l(t,"sv-handler"),m(p,i),function(e){m(e,o)}(t);let g=!1;function v(){const e=x.resizing&&n.resizing,i=g&&!n.resizing;m(t,e||i?{"background-color":"#007fd4",cursor:n.axis.sCV}:{"background-color":null,cursor:"default"})}a(t,"mouseover",(()=>g=!0)),a(t,"mouseout",(()=>g=!1)),a(t,"mousedown",(function(e){const{axis:i}=n,t=e[i.p];m(s.body,{cursor:i.sCV}),x.resizing=n.resizing=!0,n.snapshot();const o={1:z[1](x),0:z[0](x)};function u(e){const r=e[i.p]-t;n.restore(),0!==r&&w(c.abs(r),o[r>0?1:0])}a(r,"mousemove",u),a(r,"mouseup",(function e(){f(r,"mousemove",u),f(r,"mouseup",e),m(s.body,{cursor:"default"}),x.resizing=n.resizing=!1,v()}))})),a(t,"mouseover",v),a(t,"mouseout",v),a(t,"dblclick",(function(){t.dispatchEvent(d("request-reset",x.view))}));const x={resizing:!1,_size:0,0:null,1:null,get min(){return e.min},get max(){return e.max},get resizable(){return e.max!==e.min},get eView(){return p},get eHandler(){return t},get size(){return p[n.axis.oS]+.01},get o(){return p[n.axis.o]},set size(e){x.size!==e&&(m(p,{[n.axis.sS]:`${e}px`}),x.each(1,(e=>e.fixOffset())),p.dispatchEvent(d("view-size-change",x.view)))},each(e,n){let i=x[e];for(;null!==i&&null!==i[e];)n(i),i=i[e]},fixOffset(){const{axis:e}=n,i=x[0].o+x[0].size;m(p,{[e.sO]:`${i}px`}),m(t,{[e.sO]:i-2+"px "})},relayout(){const{axis:e}=n;m(p,{[e.cSS]:"100%",[e.cSO]:"0"}),m(t,{[e.cSS]:"100%",[e.cSO]:"0",[e.sS]:"4px",display:x[0].resizable?"block":"none"}),x.size=x.min},view:Object.seal({get container(){return n.container},get element(){return p},get previousSibling(){return x[0].view},get nextSibling(){return x[1].view},get size(){return c.trunc(x.size)},setSize(e){if("number"!=typeof e)throw new Error("A view size MUST be a number.");const i=h(x.min,x.max,e);if(n.snapshot(),0===b(i,x.size))return 0;const t=i-x.size;if(w(c.abs(t),z[t>0?1:0](x[1])),0!==b(i,x.size)){const e=i-x.size;w(c.abs(e),z[e>0?0:1](x))}return b(i,x.size)}})};return x}function y(){const i=u(),o=u();l(i,"sv-container"),l(o,"sv-handler-container"),m(i,n),function(e){m(e,t)}(o),i.appendChild(o);let s=null;function a(){clearTimeout(s);const e=[];y[0].each(1,(n=>e.push(n))),e.sort(((e,n)=>e.max-e.min-(n.max-n.min)));const n=e.reduce(((n,i,t)=>{const o=e.slice(t).reduce(((e,n)=>e+n.size),0),r=c.round(i.size/o*n),s=h(i.min,i.max,r);return i.size=s,n-s}),i[y.axis.oS]);y[0].each(1,(e=>e.fixOffset())),0!==n&&(s=setTimeout((()=>console.warn(`Splitview: free ${n}px`)),1e3))}let f=null;function w(){null!==i.parentElement&&(m(o,{[y.axis.cSS]:"100%",[y.axis.sS]:"0"}),y[0].each(1,(e=>e.relayout())),a())}function g(e){y[1][0][1]=e,e[0]=y[1][0],e[1]=y[1],y[1][0]=e,i.appendChild(e.eView),o.appendChild(e.eHandler)}function v(e){e[0][1]=e[1],e[1][0]=e[0],e[1]=e[0]=null,i.removeChild(e.eView),o.removeChild(e.eHandler)}function z(e){if(e.container!==y.container)throw new Error("The view does NOT belongs to this container.")}const b=new WeakMap,y={resizing:!1,axis:p.row,direction:"row",0:null,1:null,snapshot(){y[0].each(1,(e=>e._size=e.size))},restore(){y[0].each(1,(e=>e.size=e._size))},container:Object.seal({set direction(e){if("row"!==e&&"column"!==e)throw new Error("A direction MUST be `row` or `column`.");e!==y.direction&&(y.direction=e,y.axis=p[e],w())},get direction(){return y.direction},get element(){return i},get firstView(){return y[0][1].view},get lastView(){return y[1][0].view},get viewList(){const e=[];return y[0].each(1,(n=>e.push(n.view))),e},mount(e){e.appendChild(i),w(),function(){const e={width:i.offsetWidth,height:i.offsetHeight};!function n(){const t=i.offsetWidth,o=i.offsetHeight;e.width===t&&e.height===o||(a(),i.dispatchEvent(d("container-size-change",y.container))),e.width=t,e.height=o,f=r.requestAnimationFrame(n)}()}()},destroy(){i.parentElement.removeChild(i),cancelAnimationFrame(f)},relayout:w,appendView:e=>(z(e),g(b.get(e)),w(),e),removeView(e){z(e);const n=b.get(e);if(void 0===n)throw new Error("The view is NOT in container.");return v(n),w(),e},insertBefore(e,n=null){if(z(e),null===n)g(b.get(n));else{if(n.container!==y.container)throw new Error("The reference view does NOT belongs to this container.");null!==e.previousSibling&&v(b.get(e));const t=b.get(e),r=b.get(n);t[1]=r,t[0]=r[0],r[0][1]=t,r[0]=t,i.insertBefore(t.eView,r.eView),o.insertBefore(t.eHandler,r.eHandler)}return w(),e},createView(n={}){if("object"!=typeof n)throw new Error("An options MUST be an object.");const i=S(function(n){const i={min:50,max:e},{min:t=i.min,max:o=i.max}=n;if(t<0||!isFinite(t))throw new Error("A min MUST be >= 0 and finity.");if(o<t)throw new Error("A max MUST >= the min and finity.");return i.min=t,i.max=o,i}(n),y);return b.set(i.view,i),i.view}})};return y[0]=x(y),y[1]=x(y),y[0][1]=y[1],y[1][0]=y[0],y.container}export{y as Container};
